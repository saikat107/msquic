{
  "component": "BbrCongestionControl",
  "source_file": "src/core/bbr.c",
  "header_file": "src/core/bbr.h",
  "public_apis": [
    {
      "name": "BbrCongestionControlInitialize",
      "signature": "void BbrCongestionControlInitialize(_In_ QUIC_CONGESTION_CONTROL* Cc, _In_ const QUIC_SETTINGS_INTERNAL* Settings)",
      "line_range": [1089, 1160],
      "visibility": "public",
      "preconditions": [
        "Cc must be non-NULL",
        "Cc embedded in valid QUIC_CONNECTION",
        "Settings must be non-NULL",
        "Settings->InitialWindowPackets in valid range (1-1000)",
        "Connection->Paths[0] initialized with valid MTU"
      ],
      "postconditions": [
        "All function pointers initialized",
        "BbrState = STARTUP",
        "CongestionWindow set",
        "BytesInFlight = 0",
        "Filters initialized"
      ],
      "side_effects": ["Logging", "Filter initialization"]
    }
  ],
  "state_machine": {
    "states": ["STARTUP", "DRAIN", "PROBE_BW", "PROBE_RTT"],
    "initial_state": "STARTUP",
    "transitions": [
      {"from": "STARTUP", "to": "DRAIN", "condition": "BtlbwFound = TRUE"},
      {"from": "DRAIN", "to": "PROBE_BW", "condition": "BytesInFlight <= BDP"},
      {"from": "PROBE_BW", "to": "PROBE_RTT", "condition": "RttSampleExpired AND not ExitingQuiescence"},
      {"from": "PROBE_RTT", "to": "PROBE_BW", "condition": "After probe duration AND BtlbwFound"},
      {"from": "PROBE_RTT", "to": "STARTUP", "condition": "After probe duration AND NOT BtlbwFound"}
    ]
  },
  "invariants": {
    "congestion_window": "CongestionWindow >= 4 * MSS",
    "bytes_in_flight": "0 <= BytesInFlight <= BytesInFlightMax",
    "recovery_state": "RecoveryState in {NOT_RECOVERY, CONSERVATIVE, GROWTH}",
    "pacing_cycle": "PacingCycleIndex in [0, 8)"
  }
}
